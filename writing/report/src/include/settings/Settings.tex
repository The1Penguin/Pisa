% CREATED BY DAVID FRISK, 2016

% BASIC SETTINGS
\usepackage{moreverb}             % List settings
\usepackage{textcomp}             % Fonts, symbols etc.
\usepackage{lmodern}              % Latin modern font
\usepackage{AlegreyaSans}         % Nice sans font with ture small caps support
\usepackage[english]{babel}       % Language settings
\usepackage{amsmath}              % Mathematical expressions (American mathematical society)
\usepackage{amssymb}              % Mathematical symbols (American mathematical society)
\usepackage{stmaryrd}             % CS symbols, eg ⟦
\usepackage{unicode-math}         % α resolves to \alpha in math mode, etc
\usepackage{graphicx}             % Figures
\usepackage{tocloft}
\usepackage{subfig}               % Enables subfigures
\numberwithin{equation}{chapter}  % Numbering order for equations
\numberwithin{figure}{chapter}    % Numbering order for figures
\numberwithin{table}{chapter}     % Numbering order for tables
\usepackage[top=3cm, bottom=3cm, inner=3cm, outer=3cm]
           {geometry}             % Page margin lengths
\usepackage{tikz}                 % Vector graphics
\usetikzlibrary{arrows.meta,shapes,positioning}
\usepackage{eso-pic}              % Create cover page background
\usepackage{float}                % Enables object position enforcement using [H]
\usepackage{parskip}              % Enables vertical spaces correctly 
\usepackage[style=iso]{datetime2} % date formatting tools - ISO-date YYYY-MM-DD
\usepackage{microtype}            % Microtypography - improves readability and appearance of text.
\usepackage{multicol}             % Multicol environment
\usepackage[colorlinks, allcolors=black]
           {hyperref}             % Clickable links
\usepackage[nameinlink]{cleveref} % Smart references: add relevant word
\usepackage{nameref}              % Use names of references
\usepackage{crossreftools}        % Smart references: change capitalization
\usepackage{seqsplit}             % Split long character sequences
\usepackage{enumitem}
\usepackage{caption}

\input{Listings}
\usepackage{csquotes} % Language appropriate quotes, wanted by bibtex, but should load after minted
\numberwithin{listing}{chapter}   % Numbering order for listings

\usepackage[style=apa,autocite=inline,doi=true,url=true,hyperref=true,uniquename=false]{biblatex}
\addbibresource{references.bib}

% Fix unreasonably wide underscores
\usepackage{relsize}
\let\oldtextunderscore\textunderscore
\renewcommand\textunderscore{\textscale{.7}{\oldtextunderscore}}

% Center captions
\captionsetup{justification=centering,margin=1cm}

% No single lines
\widowpenalty10000
\clubpenalty10000
% Deter word wraping
\hyphenpenalty200

% Define the number of section levels to be included in the t.o.c. and numbered (3 is default)
\setcounter{tocdepth}{5}
\setcounter{secnumdepth}{5}

% Chapter title settings
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\Huge\bfseries\filcenter}
  {{\fontsize{50pt}{1em}\vspace{-4.2ex}\selectfont \textnormal{\thechapter}}}{1ex}{}[]

% Header and footer settings (Select TWOSIDE or ONESIDE layout below)
\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\space#1}{}}

% Conditional expression based on the layout choice in documentclass
\makeatletter\if@twoside\makeatother
  % Two-sided
  \fancyhf{}
  \fancyhead[LE,RO]{\nouppercase{ \leftmark}}
  \fancyfoot[LE,RO]{\thepage}
  \fancypagestyle{plain}{ % Redefine the plain page style
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \fancyfoot[LE,RO]{\thepage}}
\else\makeatother
  % One-sided
  \fancyhf{}
  \fancyhead[C]{\nouppercase{ \leftmark}}
  \fancyfoot[C]{\thepage}
\fi

% \cleardoublepage with blank styles
\makeatletter
\ExplSyntaxOn
\def\cleardoublepage@blankpage{
  \thispagestyle{empty}
  \hbox{}
  \newpage
  \if@twocolumn
    \hbox{}
    \newpage
  \fi
}
\def\cleardoublepage{
  \clearpage
  \if@twoside
    \if@openright
      \ifodd\c@page\else\cleardoublepage@blankpage\fi
    \else
      \ifodd\c@page\cleardoublepage@blankpage\fi
    \fi
  \fi
}
\ExplSyntaxOff
\makeatother


% Enable To-do notes
\usepackage[textsize=tiny]{todonotes} % Include the option "disable" to hide all notes
% TODO: does this affect the document?
\setlength{\marginparwidth}{2.5cm}


% Supress warning from Texmaker about headheight
% TODO: Neeed?
\setlength{\headheight}{15pt}

% Add goal references
\newcounter{goal}
\renewcommand\thegoal{(\Alph{goal})}
\crefname{goal}{goal}{goals}
\Crefname{goal}{Goal}{Goals}

\makeatletter\ExplSyntaxOn

\NewDocumentCommand\goal{m}{
  \refstepcounter{goal}
  \subsubsection*{\thegoal\quad #1}
  \edef\@currentlabelname{#1}
}
\NewDocumentCommand\Nref{m}{
  \hyperref[{#1}]{\ref*{#1}~\nameref*{#1}}
}
\NewDocumentCommand\nref{m}{
  % For some reason beyond me \crtlnameref* does not expand as expected
  \hyperref[{#1}]{\ref*{#1}~``\@crtlnameref@starred{#1}''}
}

\AtBeginDocument{
  \hypersetup{pdftitle = {\@title}, pdfauthor = {\@author}}
}
\ExplSyntaxOff\makeatother

% Suggested stylization of C++ (https://isocpp.org/wiki/faq/misc-environmental-issues#latex-macros)
\def\cpp{{C\hspace{-.05em}\raisebox{.4ex}{\tiny\bf ++}}}

% More readable λPure source code
\catcode`λ=11
\newcommand\λ[1]{$\lambda\text{#1}$}


% Create a step counter
\newlist{steps}{enumerate}{1}
\setlist[steps, 1]{label = Step \arabic*:,leftmargin=*}

\newfloat{conjectureset}{htbp}{loc}
\floatname{conjectureset}{Conjecture set}
\newcommand{\listofconjecturesets}{\listof{conjectureset}{List of Conjecture sets}}
\crefname{conjectureset}{conjecture set}{conjecture sets}


\newfloat{equationset}{htbp}{loc}
\floatname{equationset}{Equation set}
\newcommand{\listofequationsets}{\listof{equationset}{List of Equation sets}}
\crefname{equationset}{equation set}{equation sets}
